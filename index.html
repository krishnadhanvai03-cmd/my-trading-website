<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TradeBuddy - Your Trading Journey Starts Here</title>
    <meta
      name="description"
      content="Empower your trading decisions with TradeBuddy's state-of-the-art AI tools. Analyze, strategize, and execute with confidence on one platform."
    />
    <meta
      name="keywords"
      content="trading, AI, analytics, stock market, finance, investment, TradeBuddy"
    />
    <meta name="author" content="TradeBuddy Team" />

    <!-- Preconnect to Google Fonts for faster loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Material Icons CDN - Load with font-display: swap -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons&display=swap"
      rel="stylesheet"
    />
    <!-- Poppins Font - Load with font-display: swap -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- Critical CSS (inlined for faster FCP) -->
    <style>
      /* Back-to-top button */
      .back-to-top {
        position: fixed;
        right: 1rem;
        bottom: 1.25rem;
        background: #bb86fc;
        color: #140026;
        border: none;
        padding: 0.65rem 0.85rem;
        border-radius: 999px;
        box-shadow: 0 6px 18px rgba(155, 84, 255, 0.18);
        cursor: pointer;
        display: none;
        z-index: 2000;
        transition: transform 0.2s, opacity 0.2s;
      }
      .back-to-top.show {
        display: block;
        transform: translateY(0);
        opacity: 1;
      }
      .back-to-top:focus {
        outline: 2px solid #fff;
      }

      /* Minified and critical CSS goes here */
      /* Reset & basics */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html {
        scroll-behavior: smooth;
        /* Base font size for rem units, can be adjusted by media queries */
        font-size: 16px; 
      }
      /* Prevent horizontal scrolling and improve high-DPI text rendering */
      html, body {
        overflow-x: hidden; /* hide horizontal scrollbar caused by minor layout overflow */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
        -webkit-text-size-adjust: 100%;
      }
      /* Color palette: professional dark trading theme (centralized variables) */
      :root {
        --bg: #070617; /* base background */
        --gradient-start: #16022a; /* hero gradient start */
        --gradient-end: #040014; /* hero gradient end */
        --surface: rgba(18,10,36,0.94); /* panels/header */
        --surface-blur: rgba(20,12,44,0.88);
        --card: #1e0f33; /* card backgrounds */
        --accent: #7b4dff; /* primary accent (purple) */
        --accent-2: #22c7a9; /* secondary accent (teal) */
        --text: #e6e7f2; /* primary text */
        --muted: #b9b3c6; /* muted text */
        --success: #10b981;
        --danger: #ff6b6b;
        --glass: rgba(255,255,255,0.03);
        --on-accent: #120018; /* text color placed on accent buttons */
      }
      body {
        font-family: "Poppins", sans-serif;
        background: radial-gradient(circle at bottom, var(--gradient-start), var(--gradient-end));
        color: var(--text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        /* Responsive font size for body text */
        font-size: clamp(1rem, 0.9vw + 0.8rem, 1.125rem); /* Min 16px, Preferred 0.9vw+12.8px, Max 18px */
      }
      a {
        text-decoration: none;
        color: inherit;
      }
      .container {
        max-width: 90rem;
        margin: 0 auto;
        padding: 0 1.5rem;
        box-sizing: border-box; /* ensure padding doesn't cause overflow */
      }
      /* Ensure media and embedded elements never overflow horizontally */
      img, svg, iframe, video {
        max-width: 100%;
        height: auto;
        display: block;
      }
      header {
        background: transparent;
        position: fixed; /* use fixed so header reliably stays on top across browsers */
        top: 0;
        left: 0;
        right: 0;
        width: 100%;
        z-index: 1200; /* ensure it sits above content and overlays */
        padding: 0;
        margin: 0; /* header should span full width so inner container centers content */
      }
      .header-inner {
        max-width: 81.25rem;
        margin: 0.75rem auto; /* small vertical padding when fixed */
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--surface);
        border-radius: 3rem;
        box-shadow: 0 0.25rem 2rem 0 rgba(124, 58, 237, 0.1);
        padding: 0 2rem;
        min-height: 4.25rem;
        position: relative;
        transition: box-shadow 0.28s ease, background 0.28s ease, backdrop-filter 0.4s ease, transform 0.28s ease;
        backdrop-filter: blur(0px);
        -webkit-backdrop-filter: blur(0px);
      }
      /* stronger visual when scrolled / sticky */
      .header-inner.blur,
      header.is-sticky .header-inner {
        background: rgba(24,18,44,0.78); /* semi-transparent to allow backdrop blur */
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        box-shadow: 0 0.6rem 2.5rem 0 rgba(17,10,40,0.55);
        transform: translateY(-2px);
      }

      /* subtle raised style once sticky to improve contrast */
      header.is-sticky .header-inner {
        border-radius: 0.9rem; /* slightly smaller radius when pinned */
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
      }

      /* Ensure main content isn't hidden under the fixed header */
      main {
        padding-top: calc(4.25rem + 1.25rem); /* header min-height + margin */
      }
      .logo {
        font-weight: 700;
        /* Responsive font size for logo */
        font-size: clamp(1.25rem, 2vw, 1.5rem); 
        color: var(--accent);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        letter-spacing: 1px;
        user-select: none;
      }
      .logo .material-icons {
        /* Responsive icon size */
        font-size: clamp(1.5rem, 2.5vw, 1.75rem); 
        color: color-mix(in srgb, var(--accent) 85%, black 15%);
      }
      nav.desktop-nav {
        display: flex;
        gap: 1.75rem;
        align-items: center;
      }
      nav.desktop-nav a {
        font-weight: 500;
        position: relative;
        padding: 0.625rem 0.5rem;
        color: #ddd;
        /* Responsive font size for nav links */
        font-size: clamp(0.95rem, 1.2vw, 1.08rem); 
        border-radius: 1.125rem;
        transition: color 0.3s, background 0.2s;
      }
      nav.desktop-nav a:hover {
        color: var(--accent);
      }
      nav.desktop-nav a.active {
        color: #fff;
        background: #bb86fc33;
      }
      nav.desktop-nav a::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: 0.25rem;
        width: 100%;
        height: 0.125rem;
        background: linear-gradient(90deg, #bb86fc 60%, #9f70ff 100%);
        border-radius: 0.125rem;
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.35s cubic-bezier(0.77, 0, 0.18, 1);
        opacity: 1;
        pointer-events: none;
      }
      nav.desktop-nav a:hover::after,
      nav.desktop-nav a:focus::after {
        transform: scaleX(1);
        transform-origin: left;
      }
      nav.desktop-nav a:not(:hover):not(:focus)::after {
        transform: scaleX(0);
        transform-origin: right;
        transition: transform 0.35s cubic-bezier(0.77, 0, 0.18, 1);
      }
      .dropdown {
        position: relative;
      }
      .dropdown-content {
        margin-top: 0.625rem;
        display: none;
        position: absolute;
        background-color: rgba(26, 0, 55, 0.95);
        min-width: 10rem;
        box-shadow: 0px 0.5rem 1rem 0px rgba(0, 0, 0, 0.2);
        z-index: 1;
        border-radius: 0.5rem;
        overflow: hidden;
        opacity: 0;
        padding: 0.9375rem;
        transform: translateY(0.625rem);
        transition: opacity 0.3s ease-out, transform 0.3s ease-out;
      }
      .dropdown:hover .dropdown-content {
        display: block;
        opacity: 1;
        transform: translateY(0);
      }
      .dropdown-content a {
        color: #ddd;
        padding: 0.75rem 1rem;
        text-decoration: none;
        display: block;
        text-align: left;
        /* Responsive font size for dropdown items */
        font-size: clamp(0.9rem, 1vw, 1rem); 
        transition: background-color 0.3s, color 0.3s;
        border-radius: 0;
      }
      .dropdown-content a:hover {
        color: #bb86fc;
      }
      .dropdown-content a::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: 0.25rem;
        width: 100%;
        height: 0.125rem;
        background: linear-gradient(90deg, #bb86fc 60%, #9f70ff 100%);
        border-radius: 0.125rem;
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.35s cubic-bezier(0.77, 0, 0.18, 1);
        opacity: 1;
        pointer-events: none;
      }
      .dropdown-content a:hover::after,
      .dropdown-content a:focus::after {
        transform: scaleX(1);
        transform-origin: left;
      }
      .dropdown-content a:not(:hover):not(:focus)::after {
        transform: scaleX(0);
        transform-origin: right;
        transition: transform 0.35s cubic-bezier(0.77, 0, 0.18, 1);
      }
      .header-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      /* Improve vertical alignment of .btn-contact text */
      .btn-contact {
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--accent);
        color: var(--on-accent);
        font-weight: 700;
        padding: 0.625rem 1.375rem;
        border-radius: 1.875rem;
        border: none;
        cursor: pointer;
        transition: background 0.3s, color 0.3s, box-shadow 0.3s;
        font-size: clamp(0.9rem, 1.2vw, 1rem);
        box-shadow: 0 0.125rem 0.5rem #bb86fc33;
        height: 2.5rem; /* Fixed height for buttons */
      }
      .btn-contact:hover,
      .btn-contact:focus {
        background: color-mix(in srgb, var(--accent) 80%, black 20%);
        color: var(--text);
        box-shadow: 0 0.25rem 1rem color-mix(in srgb, var(--accent) 45%, transparent 55%);
      }
      .mobile-toggle {
        display: none;
        background: none;
        border: none;
        color: var(--accent);
        /* Responsive icon size for mobile toggle */
        font-size: clamp(2rem, 5vw, 2.3rem); 
        cursor: pointer;
        margin-left: 0.625rem;
        z-index: 1202;
        transition: color 0.2s;
        margin-right: 10px;
        /* align-items:center; */
      }
      .mobile-toggle .material-icons {
        /* Responsive icon size for mobile toggle */
        vertical-align: middle;
        font-size: clamp(2rem, 5vw, 2.3rem); 
        transition: transform 0.3s;
      }
      .mobile-toggle.open .material-icons {
        transform: rotate(90deg);
      }
      .mobile-nav-panel {
        display: none;
      }
      .mobile-nav-panel.active {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        position: fixed;
        top: 0;
        right: 0;
        width: 85vw;
        max-width: 21.25rem;
        height: 100vh;
        background: rgba(24, 20, 40, 0.98);
        box-shadow: -0.25rem 0 2rem 0 rgba(124, 58, 237, 0.1);
        border-radius: 2rem 0 0 2rem;
        padding: 2.375rem 1.75rem 1.5rem 1.75rem;
        z-index: 1201;
        gap: 1.125rem;
        animation: slideInNav 0.3s;
      }
      .mobile-nav-panel a {
        /* Responsive font size for mobile nav links */
        font-size: clamp(1.1rem, 3vw, 1.2rem); 
        padding: 0.75rem 0 0.75rem 0.375rem;
        width: 100%;
        border-radius: 0.5rem;
        text-align: left;
        color: #eee;
        font-weight: 500;
        transition: background 0.2s, color 0.2s;
        margin-bottom: 0.125rem;
      }
      .mobile-nav-panel a:hover,
      .mobile-nav-panel a.active {
        background: rgba(255, 255, 255, 0.06);
        color: #bb86fc;
      }
      .mobile-nav-panel .btn-contact {
        width: 100%;
        margin-top: 1.125rem;
        /* Responsive font size for mobile buttons */
        font-size: clamp(1rem, 3vw, 1.1rem); 
        border-radius: 1.5rem;
        padding: 0.875rem 0;
      }
      .mobile-nav-panel .close-btn {
        position: absolute;
        top: 1.125rem;
        right: 1.125rem;
        background: none;
        border: none;
        color: #bb86fc;
        /* Responsive icon size for close button */
        font-size: clamp(1.8rem, 5vw, 2.1rem); 
        cursor: pointer;
        z-index: 1203;
      }
      @keyframes slideInNav {
        from {
          right: -25rem;
          opacity: 0;
        }
        to {
          right: 0;
          opacity: 1;
        }
      }
      .mobile-nav-overlay {
        display: none;
      }
      .mobile-nav-overlay.active {
        display: block;
        position: fixed;
        inset: 0;
        background: rgba(24, 20, 40, 0.55);
        z-index: 1200;
        backdrop-filter: blur(0.125rem);
        -webkit-backdrop-filter: blur(0.125rem);
        animation: fadeInOverlay 0.3s;
      }
      @keyframes fadeInOverlay {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      /* FIX: Corrected mobile dropdown display and transition properties */
      .dropdown-mobile .dropdown-content-mobile {
        flex-direction: column;
        padding: 0 1.5rem; /* Start with 0 padding to allow transition */
        background-color: rgba(255, 255, 255, 0.03);
        border-radius: 0.5rem;
        margin-top: 0.5rem;
        overflow: hidden;
        max-height: 0;
        opacity: 0; /* Add opacity for fade effect */
        visibility: hidden; /* Add visibility for smooth transition */
        transition: max-height 0.4s ease-out, padding 0.4s ease-out, opacity 0.4s ease-out, visibility 0.4s ease-out;
      }
      .dropdown-mobile .dropdown-content-mobile.active {
        display: flex; /* Set display to flex when active */
        max-height: 10rem; /* Ensure this is large enough for all content */
        padding: 0.5rem 1.5rem 0.5rem; /* Adjust padding when active */
        opacity: 1; /* Fade in */
        visibility: visible; /* Make visible */
      }
      .dropdown-mobile .dropdown-content-mobile a {
        padding: 0.5rem 0.375rem;
        /* Responsive font size for mobile dropdown items */
        font-size: clamp(1rem, 2.5vw, 1.1rem); 
      }
      .dropdown-toggle-mobile {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
      }
      .dropdown-toggle-mobile .material-icons {
        /* Responsive icon size for mobile dropdown toggle */
        font-size: clamp(1.3rem, 3vw, 1.5rem); 
        transition: transform 0.3s ease;
      }
      .dropdown-toggle-mobile.active .material-icons {
        transform: rotate(180deg);
      }
      @media (max-width: 1200px) {
        .header-inner {
          max-width: 98vw;
          padding: 0 1rem;
        }
      }
      @media (max-width: 900px) {
        .header-inner {
          flex-direction: row;
          gap: 0;
          padding: 0 0.5rem;
        }
        nav.desktop-nav {
          display: none;
        }
        .mobile-toggle {
          display: block;
        }
        /* Hide Login/Sign Up button in header on small screens */
        .header-actions {
          display: none !important;
        }
        /* Ensure "More" (dropdown-toggle-mobile) width stays the same before/after click on mobile/tablet */
        .dropdown-mobile .dropdown-toggle-mobile {
          display: flex;
          justify-content: space-between;
          align-items: center;
          width: 100%;
          min-width: 0;
          padding-right: 0;
          /* Prevent width change on arrow rotation */
          transition: background 0.2s, color 0.2s;
        }
        .dropdown-mobile .dropdown-toggle-mobile .material-icons {
          flex-shrink: 0;
          margin-left: 8px;
          transition: transform 0.3s;
          /* Prevent arrow from pushing text */
          min-width: 24px;
          text-align: right;
        }
      }
      @media (max-width: 600px) {
        .logo {
          font-size: 1rem;
        }
        .header-inner {
          padding: 0 2vw;
          border-radius: 1.75rem;
        }
        .mobile-nav-panel {
          max-width: 98vw;
          border-radius: 0;
          padding: 1.75rem 0.625rem 1.125rem 1.125rem;
        }
      }
      .hero {
        text-align: center;
        padding: 8rem 1rem 8rem;
        position: relative;
        overflow: hidden;
      }
      /* Subtle animated gradient to give a higher-quality, dynamic background */
      .hero::before {
        content: '';
        position: absolute;
        inset: -25% -15% -25% -15%;
        background: radial-gradient(circle at 10% 20%, rgba(159,112,255,0.10), transparent 8%),
                    radial-gradient(circle at 90% 80%, rgba(187,134,252,0.08), transparent 10%);
        z-index: 0;
        pointer-events: none;
        transform: translateZ(0);
        animation: heroSlowMove 14s linear infinite;
        will-change: transform, opacity;
      }
      @keyframes heroSlowMove {
        0% { transform: translate3d(0,0,0) scale(1); }
        50% { transform: translate3d(-2%,0,0) scale(1.02); }
        100% { transform: translate3d(0,0,0) scale(1); }
      }

      /* Slight contrast boost for better legibility on very high-DPI displays */
      .hero-title, .section-title, .card-title, .step-title {
        text-shadow: 0 0.35px 0 rgba(0,0,0,0.18);
        -webkit-font-smoothing: antialiased;
      }
      .hero-title {
        /* Using clamp for responsive font size */
        font-size: clamp(2.5rem, 6vw, 3.5rem); 
        font-weight: 800;
        line-height: 1.15;
        max-width: 43.75rem;
        margin: 0 auto 1rem auto;
        color: var(--text);
        animation: fadeInUp 1.4s ease forwards;
      }
      .hero-desc {
        color: var(--muted);
        /* Using clamp for responsive font size */
        font-size: clamp(1rem, 2.5vw, 1.1rem); 
        max-width: 36.25rem;
        margin: 0 auto 3rem;
        font-weight: 500;
        animation: fadeInUp 1.6s ease forwards;
      }
      .hero-button {
        padding: 0.875rem 2.25rem;
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        border-radius: 2.5rem;
        font-weight: 700;
        /* Responsive font size for hero button */
        font-size: clamp(1rem, 2.5vw, 1.1rem); 
        color: var(--on-accent);
        border: none;
        cursor: pointer;
        transition: background 0.3s;
        box-shadow: 0 0 0.75rem #bb86fcaa;
        animation: pulseGlow 2.8s ease infinite;
      }
      .hero-button:hover,
      .hero-button:focus {
        filter: brightness(1.03) saturate(1.05);
        color: var(--text);
      }
      .cards {
        display: grid;
        max-width: 75rem;
        margin: 3.75rem auto 5rem;
        gap: 2.5rem;
        padding: 0 1rem;
      }
      @media (min-width: 769px) {
        .cards {
          grid-template-columns: repeat(3, 1fr);
        }
      }
      @media (max-width: 768px) {
        .cards {
          grid-template-columns: 1fr;
          margin: 3rem auto 4rem;
        }
      }
      @media (max-width: 480px) {
        .cards {
          padding: 0 0.75rem;
        }
      }
      /* Unified card surface style matching the provided visual */
      .card,
      .step-card,
      .testimonial-card,
      .why-choose-us-point {
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.14));
        border-radius: 1.125rem;
        padding: 2rem 2.25rem;
        color: var(--text);
        box-shadow: 0 18px 40px rgba(6,2,20,0.55), inset 0 1px 0 rgba(255,255,255,0.02);
        transition: transform 0.36s cubic-bezier(0.2,0.9,0.2,1), box-shadow 0.36s;
        position: relative;
        overflow: visible;
      }

      .card:hover,
      .card:focus-within,
      .step-card:hover,
      .testimonial-card:hover,
      .why-choose-us-point:hover {
        transform: translateY(-6px);
        box-shadow: 0 28px 60px rgba(12,6,40,0.6), inset 0 1px 0 rgba(255,255,255,0.03);
      }

      /* soft bottom glow to match the attached design */
      .card::after,
      .step-card::after,
      .testimonial-card::after,
      .why-choose-us-point::after {
        content: '';
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        bottom: -18px;
        width: 75%;
        height: 22px;
        background: radial-gradient(closest-side, rgba(123,77,255,0.14), transparent 60%);
        filter: blur(12px);
        pointer-events: none;
        z-index: -1;
      }

      .card-icon {
        font-size: clamp(2rem, 5vw, 2.6rem);
        color: var(--accent);
        width: 3.25rem;
        height: 3.25rem;
        display: inline-grid;
        place-items: center;
        border-radius: 12rem;
        margin-bottom: 1.25rem;
        background: radial-gradient(circle at 30% 30%, color-mix(in srgb, var(--accent) 60%, transparent 40%), transparent 45%);
        box-shadow: 0 8px 20px rgba(123,77,255,0.08), 0 0 18px rgba(123,77,255,0.06) inset;
      }

      .card-title {
        font-size: clamp(1.15rem, 2.6vw, 1.35rem);
        font-weight: 800;
        margin-bottom: 0.6rem;
        text-align: left;
        color: var(--text);
      }

      .card-desc {
        font-weight: 400;
        color: var(--muted);
        text-align: left;
        line-height: 1.6;
        font-size: clamp(0.95rem, 1.9vw, 1rem);
      }
      .section-title {
        /* Using clamp for responsive font size */
        font-size: clamp(2rem, 5vw, 3rem); 
        font-weight: 800;
        text-align: center;
        color: var(--text);
        margin-bottom: 1rem;
        line-height: 1.2;
      }
      .section-subtitle {
        /* Using clamp for responsive font size */
        font-size: clamp(1rem, 2.5vw, 1.25rem); 
        text-align: center;
        color: #c9c7e9;
        max-width: 45rem;
        margin: 0 auto 3rem;
        font-weight: 500;
      }
      .how-it-works {
        padding: 5rem 1rem;
      }
      .steps-grid {
        display: grid;
        /* Adjust minmax for better responsiveness on smaller screens */
        grid-template-columns: repeat(auto-fit, minmax(16rem, 1fr)); 
        gap: 2.5rem;
        margin-top: 4rem;
      }
      .step-card {
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.14));
        border-radius: 1.125rem;
        padding: 2.25rem;
        color: var(--text);
        text-align: left;
        position: relative;
        overflow: visible;
        transition: transform 0.36s cubic-bezier(0.2,0.9,0.2,1), box-shadow 0.36s;
      }
      .step-card:hover { transform: translateY(-6px); }
      .step-number {
        /* Responsive font size for step numbers */
        font-size: clamp(3rem, 8vw, 3.5rem); 
        font-weight: 900;
        color: rgba(187, 134, 252, 0.2);
        position: absolute;
        top: 0.5rem;
        left: 0.5rem;
        z-index: 0;
        line-height: 1;
      }
      .step-content {
        position: relative;
        z-index: 1;
      }
      .step-icon {
        font-size: clamp(1.8rem, 4.5vw, 2.6rem);
        color: var(--accent);
        display: inline-grid;
        place-items: center;
        width: 3rem;
        height: 3rem;
        border-radius: 999px;
        background: radial-gradient(circle at 35% 30%, color-mix(in srgb, var(--accent) 60%, transparent 40%), transparent 45%);
        box-shadow: 0 8px 18px rgba(123,77,255,0.06);
        margin-bottom: 1rem;
      }
      .step-title {
        font-size: clamp(1.25rem, 3vw, 1.5rem);
        font-weight: 800;
        margin-bottom: 0.45rem;
        color: var(--text);
      }
      .step-desc {
        font-size: clamp(0.95rem, 1.8vw, 1rem);
        color: var(--muted);
        line-height: 1.6;
      }
      .testimonials {
        padding: 5rem 1rem;
      }
      .testimonial-grid {
        display: grid;
        /* Adjust minmax for better responsiveness on smaller screens */
        grid-template-columns: repeat(auto-fit, minmax(18rem, 1fr)); 
        gap: 2rem;
        margin-top: 4rem;
      }
      .testimonial-card {
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.14));
        border-radius: 1.125rem;
        padding: 1.75rem 1.875rem;
        color: var(--text);
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        transition: transform 0.36s cubic-bezier(0.2,0.9,0.2,1), box-shadow 0.36s;
        position: relative;
      }
      .testimonial-card:hover { transform: translateY(-6px); }
      .testimonial-quote {
        font-size: clamp(0.98rem, 2.1vw, 1.05rem);
        line-height: 1.7;
        margin-bottom: 1.2rem;
        color: var(--muted);
      }
      .testimonial-author {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-top: auto;
      }
      .author-avatar {
        /* Responsive avatar size */
        width: clamp(3rem, 6vw, 3.5rem); 
        height: clamp(3rem, 6vw, 3.5rem); 
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #bb86fc;
      }
      .author-info strong {
        display: block;
        /* Responsive font size for author name */
        font-size: clamp(1rem, 2.2vw, 1.1rem); 
        color: #bb86fc;
      }
      .author-info span {
        /* Responsive font size for author title */
        font-size: clamp(0.8rem, 1.8vw, 0.9rem); 
        color: #c9c7e9;
      }
      .cta-section,
      .vision-section,
      .why-choose-us-section {
        padding: 5rem 1rem;
        text-align: center;
        border-radius: 1.5rem;
        margin: 5rem auto;
        max-width: 75rem;
        box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.3);
        overflow: hidden;
        position: relative;
      }
      .cta-section::before,
      .vision-section::before,
      .why-choose-us-section::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle at 50% 50%,
          rgba(255, 255, 255, 0.05) 0%,
          transparent 70%
        );
        animation: rotateLight 15s linear infinite;
        opacity: 0.7;
      }
      @keyframes rotateLight {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      .cta-content,
      .vision-content,
      .why-choose-us-content {
        position: relative;
        z-index: 1;
      }
      .cta-title,
      .vision-title,
      .why-choose-us-title {
        /* Using clamp for responsive font size */
        font-size: clamp(2.2rem, 5vw, 3.5rem); 
        font-weight: 800;
        color: #fff;
        margin-bottom: 1.5rem;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }
      .cta-desc,
      .vision-desc,
      .why-choose-us-desc {
        /* Using clamp for responsive font size */
        font-size: clamp(1rem, 2.5vw, 1.25rem); 
        color: #f0eaff;
        max-width: 50rem;
        margin: 0 auto 2.5rem;
        line-height: 1.6;
      }
      .cta-button,
      .vision-button,
      .why-choose-us-button {
        padding: 1rem 2.5rem;
        background: var(--bg);
        color: var(--accent);
        border-radius: 2.5rem;
        font-weight: 700;
        /* Responsive font size for CTA buttons */
        font-size: clamp(1rem, 2.5vw, 1.1rem); 
        border: 2px solid var(--accent);
        cursor: pointer;
        transition: background 0.3s, color 0.3s, transform 0.3s, box-shadow 0.3s;
        box-shadow: 0 0.25rem 1rem rgba(0, 0, 0, 0.2);
      }
      .cta-button:hover,
      .vision-button:hover,
      .why-choose-us-button:hover {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        color: var(--on-accent);
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 0.5rem 1.5rem rgba(187, 134, 252, 0.4);
      }
      .why-choose-us-points {
        display: grid;
        /* Adjust minmax for better responsiveness on smaller screens */
        grid-template-columns: repeat(auto-fit, minmax(14rem, 1fr)); 
        gap: 2rem;
        margin-top: 3rem;
        text-align: left;
      }
      .why-choose-us-point {
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));
        padding: 1.5rem;
        border-radius: 1rem;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease, background 0.3s ease;
      }
      .why-choose-us-point:hover {
        transform: translateY(-5px);
        background: rgba(0, 0, 0, 0.3);
      }
      .why-choose-us-point .material-icons {
        /* Responsive icon size */
        font-size: clamp(2rem, 5vw, 2.5rem); 
        color: var(--accent);
        margin-bottom: 0.75rem;
      }
      .why-choose-us-point h4 {
        /* Responsive font size for point titles */
        font-size: clamp(1.1rem, 2.5vw, 1.25rem); 
        color: #fff;
        margin-bottom: 0.5rem;
      }
      .why-choose-us-point p {
        /* Responsive font size for point descriptions */
        font-size: clamp(0.85rem, 1.8vw, 0.95rem); 
        color: #e0e0e0;
        line-height: 1.5;
      }
      footer {
        background: #140026;
        color: #bbb8ddcc;
        padding: 3rem 1rem;
        /* Responsive font size for footer */
        font-size: clamp(0.8rem, 1.5vw, 0.9rem); 
        text-align: center;
        border-top: 0.0625rem solid #3a1666;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes fadeInDown {
        0% {
          opacity: 0;
          transform: translateY(-0.9375rem);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes fadeInUp {
        0% {
          opacity: 0;
          transform: translateY(2.1875rem);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes pulseGlow {
        0%,
        100% {
          box-shadow: 0 0 0.75rem #bb86fcaa, 0 0 2rem #bb86fc55;
          transform: scale(1);
        }
        50% {
          box-shadow: 0 0 1.125rem #bb86fcff, 0 0 2.5rem #bb86fcaa;
          transform: scale(1.05);
        }
      }
      @keyframes iconPulse {
        0%,
        100% {
          color: #bb86fc;
          filter: drop-shadow(0 0 0.125rem #bb86fc88);
        }
        50% {
          color: #d1b3ff;
          filter: drop-shadow(0 0 0.375rem #d1b3ffdd);
        }
      }
      .fade-in-section {
        opacity: 0;
        transform: translateY(1.25rem);
        transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        will-change: opacity, transform;
      }
      .fade-in-section.is-visible {
        opacity: 1;
        transform: translateY(0);
      }
      /* Subtle slide-in from left / right for professional scroll animations */
      .slide-in-left,
      .slide-in-right {
        opacity: 0;
        transform: translateY(0) translateX(0);
        transition: transform 0.8s cubic-bezier(0.2, 0.9, 0.2, 1), opacity 0.6s ease-out;
        will-change: transform, opacity;
      }
      .slide-in-left { transform: translateX(-2.5rem); }
      .slide-in-right { transform: translateX(2.5rem); }
      .fade-in-section.is-visible.slide-in-left,
      .fade-in-section.is-visible.slide-in-right {
        opacity: 1;
        transform: translateX(0) translateY(0);
      }

      /* Staggered child reveals for grouped elements (cards, steps, testimonials) */
      .stagger-child {
        opacity: 0;
        transform: translateY(0.75rem);
        transition: transform 0.65s cubic-bezier(0.2, 0.9, 0.2, 1), opacity 0.45s ease-out;
        will-change: transform, opacity;
      }
      .in-view-child {
        opacity: 1 !important;
        transform: translateY(0) !important;
      }

      /* Small micro-interactions */
      .card:hover .card-icon { transform: translateY(-6px) scale(1.03); }
      .card .card-icon { transition: transform 0.45s cubic-bezier(0.2,0.9,0.2,1); }
      .why-choose-us-point { transition: transform 0.35s ease, box-shadow 0.35s ease, background 0.35s ease; }
      .why-choose-us-point:hover { transform: translateY(-6px) scale(1.01); box-shadow: 0 1.4rem 3rem rgba(120,60,220,0.12); }

      /* Decorative underline animation for section titles */
      .section-title { position: relative; }
      .section-title::after {
        content: '';
        position: absolute;
        left: 50%;
        transform: translateX(-50%) scaleX(0);
        bottom: -0.6rem;
        width: 6rem;
        height: 0.25rem;
        background: linear-gradient(90deg,#bb86fc,#9f70ff);
        border-radius: 0.25rem;
        transition: transform 0.6s cubic-bezier(0.2,0.9,0.2,1);
        transform-origin: center;
      }
      .fade-in-section.is-visible .section-title::after { transform: translateX(-50%) scaleX(1); }
      .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(0.5rem);
        -webkit-backdrop-filter: blur(0.5rem);
        justify-content: center;
        align-items: center;
        animation: fadeInOverlay 0.3s ease-out;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: radial-gradient(circle at top, #3c1164, #140026 90%);
        margin: auto;
        padding: 2.5rem;
        border-radius: 1.25rem;
        box-shadow: 0 0.625rem 1.875rem rgba(0, 0, 0, 0.5);
        position: relative;
        width: 90%;
        max-width: 37.5rem;
        text-align: center;
        transform: scale(0.9);
        opacity: 0;
        animation: modalPopIn 0.4s forwards cubic-bezier(0.2, 0.8, 0.2, 1);
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
      }
      @keyframes modalPopIn {
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
      .close-modal-btn {
        color: #aaa;
        position: absolute;
        top: 0.9375rem;
        right: 1.5625rem;
        /* Responsive font size for close button */
        font-size: clamp(1.8rem, 5vw, 2.1875rem); 
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s;
        background-color: transparent;
        border: none;
      }
      .close-modal-btn:hover,
      .close-modal-btn:focus {
        color: #bb86fc;
        text-decoration: none;
        cursor: pointer;
      }
      .modal-title {
        /* Using clamp for responsive font size */
        font-size: clamp(1.8rem, 4vw, 2.2rem); 
        color: #bb86fc;
        margin-bottom: 1.25rem;
        font-weight: 700;
      }
      .modal-form-container {
        display: flex;
        flex-direction: column;
        gap: 0.9375rem;
        width: 100%;
      }
      .modal-form-container input[type="text"],
      .modal-form-container input[type="email"],
      .modal-form-container input[type="password"] {
        width: calc(100% - 1.25rem);
        padding: 0.75rem 0.625rem;
        margin: 0.5rem 0;
        display: inline-block;
        border: 0.0625rem solid #5e32cc;
        border-radius: 0.5rem;
        box-sizing: border-box;
        background-color: rgba(255, 255, 255, 0.08);
        color: #eee;
        /* Responsive font size for input fields */
        font-size: clamp(0.9rem, 2vw, 1rem); 
        transition: border-color 0.3s, background-color 0.3s;
      }
      .modal-form-container input[type="text"]:focus,
      .modal-form-container input[type="email"]:focus,
      .modal-form-container input[type="password"]:focus {
        border-color: #bb86fc;
        background-color: rgba(255, 255, 255, 0.15);
        outline: none;
      }
      .modal-form-container button {
        background: #bb86fc;
        color: #140026;
        font-weight: 700;
        padding: 0.75rem 1.25rem;
        border: none;
        border-radius: 1.875rem;
        cursor: pointer;
        /* Responsive font size for form buttons */
        font-size: clamp(1rem, 2.5vw, 1.1rem); 
        transition: background 0.3s, box-shadow 0.3s;
        margin-top: 0.625rem;
      }
      .modal-form-container button:hover {
        background: #9d5cff;
        box-shadow: 0 0.25rem 1rem #bb86fc55;
      }
      .form-toggle-text {
        color: #ccc;
        /* Responsive font size for toggle text */
        font-size: clamp(0.85rem, 1.8vw, 0.95rem); 
        margin-top: 0.9375rem;
      }
      .form-toggle-text a {
        color: #bb86fc;
        font-weight: 600;
        cursor: pointer;
        transition: color 0.3s;
      }
      .form-toggle-text a:hover {
        color: #9d5cff;
      }
      
      .form-wrapper {
        position: relative;
        overflow: hidden;
        transition: height 0.5s ease-in-out;
      }
      .login-section,
      .signup-section {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out,
          visibility 0.5s ease-in-out;
        opacity: 0;
        visibility: hidden;
        transform: translateX(100%);
        padding-bottom: 0.0625rem;
      }
      .login-section.active {
        opacity: 1;
        visibility: visible;
        transform: translateX(0);
        z-index: 2;
      }
      .signup-section.active {
        opacity: 1;
        visibility: visible;
        transform: translateX(0);
        z-index: 2;
      }
      .login-section.slide-out-left {
        transform: translateX(-100%);
        opacity: 0;
        visibility: hidden;
        z-index: 1;
      }
      .signup-section.slide-in-right {
        transform: translateX(0);
        opacity: 1;
        visibility: visible;
        z-index: 2;
      }
      .signup-section.slide-out-right {
        transform: translateX(100%);
        opacity: 0;
        visibility: hidden;
        z-index: 1;
      }
      .login-section.slide-in-left {
        transform: translateX(0);
        opacity: 1;
        visibility: visible;
        z-index: 2;
      }
      @media (max-width: 768px) {
        .modal-content {
          padding: 1.875rem;
          width: 95%;
        }
        .modal-title {
          font-size: 1.8rem;
        }
      }
      @media (max-width: 480px) {
        .modal-content {
          padding: 1.25rem;
        }
        .modal-title {
          font-size: 1.5rem;
        }
        .modal-form-container input {
          padding: 0.625rem;
        }
        .modal-form-container button {
          padding: 0.625rem 0.9375rem;
          font-size: 1rem;
        }
      }

      /* For screen-reader only accessibility */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }

      /* NEW: FAQ Section Styles */
      .faq-section {
        padding: 5rem 1rem;
        text-align: center;
      }

      .faq-container {
        max-width: 60rem;
        margin: 3rem auto 0;
        text-align: left;
      }

      .faq-item {
        background: #2e0e70;
        border-radius: 0.75rem;
        margin-bottom: 1rem;
        overflow: hidden;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.2);
      }

      .faq-question {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.25rem 1.5rem;
        /* Responsive font size for FAQ questions */
        font-size: clamp(1rem, 2.5vw, 1.15rem); 
        font-weight: 600;
        color: #e3dffd;
        cursor: pointer;
        background: #3a1666;
        border: none;
        width: 100%;
        text-align: left;
        transition: background 0.3s ease;
      }

      .faq-question:hover,
      .faq-question:focus {
        background: #4c1e80;
      }

      .faq-question .material-icons {
        /* Responsive icon size for FAQ toggle */
        font-size: clamp(1.5rem, 3vw, 1.8rem); 
        transition: transform 0.3s ease;
      }

      .faq-question.active .material-icons {
        transform: rotate(180deg);
      }

      .faq-answer {
        padding: 0 1.5rem;
        /* Responsive font size for FAQ answers */
        font-size: clamp(0.9rem, 2vw, 1rem); 
        color: #d7d3f5;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s ease-out, padding 0.4s ease-out;
      }

      .faq-answer.active {
        max-height: 10rem; /* Adjust based on expected content height */
        padding: 1rem 1.5rem 1.25rem;
      }

      /* Search modal specific styles */
      .search-modal .modal-content {
        max-width: 84rem;
        padding: 1rem 1.25rem;
        width: 95%;
        align-items: stretch;
        /* keep overall header centered but force search results left aligned below */
      }
      /* Force results and result items to be left-aligned (overrides modal center) */
      .search-modal .results,
      .search-modal .result-item,
      .search-modal .no-results {
        text-align: left;
      }
      .search-header {
        display:flex;
        gap:0.5rem;
        align-items:center;
      }
      .search-input {
        flex:1;
        padding:0.75rem 1rem;
        border-radius:0.75rem;
        border:0.0625rem solid rgba(255,255,255,0.06);
        background: rgba(255,255,255,0.03);
        color:#fff;
        font-size:1rem;
      }
      .search-clear {
        background:transparent;
        border:none;
        color:#ccc;
        padding:0.5rem;
        cursor:pointer;
      }
      .chips {
        display:flex;
        gap:0.5rem;
        flex-wrap:wrap;
        margin-top:0.75rem;
        margin-bottom:0.75rem;
      }
      .chip {
        padding:0.35rem 0.75rem;
        border-radius:999px;
        background: rgba(255,255,255,0.04);
        color:#ddd;
        font-weight:600;
        cursor:pointer;
        border: 0.0625rem solid rgba(255,255,255,0.03);
      }
      .chip.active {
        background: linear-gradient(90deg,#bb86fc,#9f70ff);
        color:#140026;
      }
      .results {
        margin-top:0.75rem;
        max-height:40vh;
        overflow:auto;
        padding-right:0.5rem;
        /* make scrollbar thin & translucent across browsers */
        scrollbar-width: thin; /* Firefox */
        scrollbar-color: rgba(255,255,255,0.08) transparent; /* Firefox */
      }
      /* live price badge */
      .price {
        min-width:96px;
        text-align:right;
        font-weight:700;
        font-size:0.95rem;
        color:#cfc7e8;
      }
      .price .value { display:block; }
      .price .delta { font-size:0.78rem; opacity:0.9; }
      .price.up { color:#9ef0b5; }
      .price.down { color:#ff9b9b; }
      /* ensure price column doesn't wrap badly on very small screens */
      @media (max-width:420px){ .price{ min-width:72px; font-size:0.85rem } }
      /* WebKit (Chrome, Edge, Safari) transparent/thin scrollbar for the search results */
      .results::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      .results::-webkit-scrollbar-track {
        background: transparent;
      }
      .results::-webkit-scrollbar-thumb {
        background: rgba(255,255,255,0.06);
        border-radius: 8px;
        border: 2px solid transparent; /* preserve space so thumb doesn't overlap content */
        background-clip: padding-box;
      }
      .results::-webkit-scrollbar-thumb:hover {
        background: rgba(255,255,255,0.10);
      }

      .result-item {
        display:flex;
        justify-content:space-between;
        align-items:center;
        padding:0.75rem 0.5rem;
        border-bottom:0.0625rem solid rgba(255,255,255,0.03);
        color:#eee;
        text-align: left; /* ensure left alignment for symbol rows */
      }
      .no-results {
        color:#c9c7e9;
        padding:1rem 0.5rem;
        text-align:left; /* single left-aligned message inside results area */
      }
      /* --- END OF CRITICAL CSS --- */

      /* General styles */
      /* ...existing styles... */
    </style>
  </head>
  <body>
    <header>
      <div class="header-inner container" id="mainHeader">
        <a href="#" class="logo" aria-label="TradeBuddy Logo">
          <span class="material-icons" aria-hidden="true">show_chart</span>
          TradeBuddy
        </a>
        <nav class="desktop-nav" aria-label="Primary navigation">
          <a href="#trade" tabindex="0">Trade</a>
          <a href="#contact" tabindex="0">Contact</a>
          <a href="#pricing" tabindex="0">Pricing</a>
          <a href="#services" tabindex="0">Services</a>
          <div class="dropdown">
            <a href="#more" tabindex="0">More</a>
            <div class="dropdown-content">
              <a href="#search">Search</a>
              <a href="#news">News</a>
              <a href="#fno">F&O</a>
            </div>
          </div>
        </nav>
        <div class="header-actions">
          
            <a class="btn-contact"
            id="loginSignupBtn"
            aria-label="Login or Sign Up" href="login.html">Login / Sign Up</a>
          
        </div>
        <button
          class="mobile-toggle"
          aria-label="Toggle navigation menu"
          aria-expanded="false"
        >
          <span class="material-icons">menu</span>
        </button>
      </div>
      <!-- Mobile Nav Panel -->
      <div
        class="mobile-nav-panel"
        id="mobileNavPanel"
        aria-label="Mobile navigation"
      >
        <button class="close-btn" aria-label="Close menu">
          <span class="material-icons">close</span>
        </button>
        <a href="#trade">Trade</a>
        <a href="#contact">Contact</a>
        <a href="#pricing">Pricing</a>
        <a href="#services">Services</a>
        <div class="dropdown-mobile">
          <a href="#more" class="dropdown-toggle-mobile">
            More
            <span class="material-icons">expand_more</span>
          </a>
          <div class="dropdown-content-mobile">
            <a href="#search">Search</a>
            <a href="#news">News</a>
            <a href="#fno">F&O</a>
          </div>
        </div>
        <a
          class="btn-contact"
    
          href="login.html"
        >
          Login In/Sign Up
        </a>
      </div>
      <div class="mobile-nav-overlay" id="mobileNavOverlay"></div>
    <!-- Search Modal (opens when href="#search" clicked) -->
    <div class="modal" id="searchModal" aria-hidden="true" role="dialog" aria-label="Search">
      <div class="modal-content search-modal" role="document">
        <button class="close-modal-btn" id="closeSearchModal" aria-label="Close search">&times;</button>
        <div class="search-header">
          <input id="searchInput" class="search-input" type="search" placeholder="Symbol, name, ISIN or CUSIP" aria-label="Search symbols" />
          <button id="clearSearch" class="search-clear" aria-label="Clear search">Clear</button>
        </div>
        <div class="chips" id="searchChips" role="tablist" aria-label="Search categories"></div>
        <div id="searchStatus" aria-live="polite" style="min-height:1.5rem;"></div>
        <div class="results" id="searchResults" role="list"></div>
      </div>
    </div>
    </header>
    <main>
      <section
        class="hero fade-in-section"
        role="banner"
        aria-labelledby="hero-title"
      >
        <h1 class="hero-title" id="hero-title">
          Your Trading Journey Starts From Here
        </h1>
        <p class="hero-desc">
          Empower your trading decisions with TradeBuddy's state-of-the-art AI
          tools. Analyze, strategize, and execute with confidence on one
          platform.
        </p>
        <a
          class="hero-button"
          id="startFreeTrialBtn"
          aria-label="Start Free Trial"
          href="login.html"
        >
          Start Free Trial
        </a>
      </section>
      <section
        class="cards container fade-in-section"
        aria-label="Trading platform key features"
        id="features"
      >
        <article class="card" tabindex="0">
          <span class="card-icon material-icons" aria-hidden="true"
            >insights</span
          >
          <h3 class="card-title">Advanced Analytics</h3>
          <p class="card-desc">
            Gain deep insights with real-time market data and AI-powered
            analytics tailored to boost your trading edge.
          </p>
        </article>

        <article class="card" tabindex="0">
          <span class="card-icon material-icons" aria-hidden="true"
            >security</span
          >
          <h3 class="card-title">Secure Trading</h3>
          <p class="card-desc">
            Your transactions are protected with industry-leading encryption and
            multi-factor authentication protocols.
          </p>
        </article>
        <article class="card" tabindex="0">
          <span class="card-icon material-icons" aria-hidden="true"
            >support_agent</span
          >
          <h3 class="card-title">24/7 Support</h3>
          <p class="card-desc">
            Our expert team is always ready to assist you, ensuring your trading
            journey is smooth and successful.
          </p>
        </article>
      </section>

      <section class="how-it-works fade-in-section" id="how-it-works">
        <div class="container">
          <h2 class="section-title">How TradeBuddy Works</h2>
          <p class="section-subtitle">
            Get started with TradeBuddy in three simple steps. From sign-up to
            smart trading, we make it easy for you.
          </p>
          <div class="steps-grid">
            <div class="step-card">
              <span class="step-number">01</span>
              <div class="step-content">
                <span class="step-icon material-icons">person_add</span>
                <h3 class="step-title">Create Your Account</h3>
                <p class="step-desc">
                  Sign up in minutes and set up your personalized trading
                  profile. It's quick, secure, and free to start.
                </p>
              </div>
            </div>
            <div class="step-card">
              <span class="step-number">02</span>
              <div class="step-content">
                <span class="step-icon material-icons">analytics</span>
                <h3 class="step-title">Analyze & Strategize</h3>
                <p class="step-desc">
                  Utilize our AI-powered tools to analyze market trends and
                  develop winning trading strategies.
                </p>
              </div>
            </div>
            <div class="step-card">
              <span class="step-number">03</span>
              <div class="step-content">
                <span class="step-icon material-icons">trending_up</span>
                <h3 class="step-title">Execute Trades</h3>
                <p class="step-desc">
                  Seamlessly execute your trades with confidence and monitor
                  your portfolio in real-time.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="vision-section fade-in-section" id="our-vision">
        <div class="container vision-content">
          <h2 class="vision-title">Our Vision for Your Success</h2>
          <p class="vision-desc">
            We envision a world where every trader, regardless of experience,
            has access to powerful tools and insights to achieve their financial
            goals. TradeBuddy is built on this principle.
          </p>
          <button class="vision-button">Learn More About Our Mission</button>
        </div>
      </section>

      <section class="why-choose-us-section fade-in-section" id="why-choose-us">
        <div class="container why-choose-us-content">
          <h2 class="why-choose-us-title">Why Choose TradeBuddy?</h2>
          <p class="why-choose-us-desc">
            Beyond advanced features, we offer a commitment to your growth and
            security. Discover what sets us apart.
          </p>
          <div class="why-choose-us-points">
            <div class="why-choose-us-point">
              <span class="material-icons">auto_graph</span>
              <h4>Cutting-Edge AI</h4>
              <p>
                Leverage predictive analytics and machine learning for smarter
                trading decisions.
              </p>
            </div>
            <div class="why-choose-us-point">
              <span class="material-icons">verified_user</span>
              <h4>Unwavering Security</h4>
              <p>
                Your data and assets are protected with military-grade
                encryption and protocols.
              </p>
            </div>
            <div class="why-choose-us-point">
              <span class="material-icons">school</span>
              <h4>Educational Resources</h4>
              <p>
                Access a wealth of tutorials, webinars, and market insights to
                sharpen your skills.
              </p>
            </div>
            <div class="why-choose-us-point">
              <span class="material-icons">forum</span>
              <h4>Vibrant Community</h4>
              <p>
                Connect with fellow traders, share strategies, and grow together
                in a supportive environment.
              </p>
            </div>
          </div>
          <button class="why-choose-us-button" style="margin-top: 3rem">
            Explore All Benefits
          </button>
        </div>
      </section>

      <section class="testimonials fade-in-section" id="testimonials">
        <div class="container">
          <h2 class="section-title">What Our Traders Say</h2>
          <p class="section-subtitle">
            Hear directly from our community about how TradeBuddy has
            transformed their trading experience.
          </p>
          <div class="testimonial-grid">
            <div class="testimonial-card">
              <p class="testimonial-quote">
                "TradeBuddy's analytics are a game-changer! I've never felt this
                confident in my trading decisions before. The insights are
                unparalleled."
              </p>
              <div class="testimonial-author">
                <img
                  src="https://placehold.co/60/bb86fc/ffffff?text=JD"
                  alt="John Doe"
                  class="author-avatar"
                  width="60"
                  height="60"
                  loading="lazy"
                />
                <div class="author-info">
                  <strong>John Doe</strong>
                  <span>Experienced Trader</span>
                </div>
              </div>
            </div>
            <div class="testimonial-card">
              <p class="testimonial-quote">
                "The 24/7 support is incredible. Whenever I had a question,
                their team was there to help, making my journey so much
                smoother. Highly recommend!"
              </p>
              <div class="testimonial-author">
                <img
                  src="https://placehold.co/60/bb86fc/ffffff?text=AS"
                  alt="Alice Smith"
                  class="author-avatar"
                  width="60"
                  height="60"
                  loading="lazy"
                />
                <div class="author-info">
                  <strong>Alice Smith</strong>
                  <span>New Investor</span>
                </div>
              </div>
            </div>
            <div class="testimonial-card">
              <p class="testimonial-quote">
                "Security is my top priority, and TradeBuddy delivers. I feel
                completely safe with my investments here. A truly reliable
                platform."
              </p>
              <div class="testimonial-author">
                <img
                  src="https://placehold.co/60/bb86fc/ffffff?text=MB"
                  alt="Michael Brown"
                  class="author-avatar"
                  width="60"
                  height="60"
                  loading="lazy"
                />
                <div class="author-info">
                  <strong>Michael Brown</strong>
                  <span>Portfolio Manager</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- NEW: FAQ Section -->
      <section class="faq-section fade-in-section" id="faq">
        <div class="container">
          <h2 class="section-title">Frequently Asked Questions</h2>
          <p class="section-subtitle">
            Find quick answers to the most common questions about TradeBuddy.
          </p>
          <div class="faq-container">
            <div class="faq-item">
              <button class="faq-question" aria-expanded="false">
                What is TradeBuddy?
                <span class="material-icons">expand_more</span>
              </button>
              <div class="faq-answer">
                <p>
                  TradeBuddy is an AI-powered platform designed to empower your
                  trading decisions with advanced analytics, secure trading, and
                  24/7 support.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <button class="faq-question" aria-expanded="false">
                How does the AI assist my trading?
                <span class="material-icons">expand_more</span>
              </button>
              <div class="faq-answer">
                <p>
                  Our AI leverages predictive analytics and machine learning to
                  analyze market trends, provide insights, and help you develop
                  smarter trading strategies.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <button class="faq-question" aria-expanded="false">
                Is my data secure with TradeBuddy?
                <span class="material-icons">expand_more</span>
              </button>
              <div class="faq-answer">
                <p>
                  Absolutely. We prioritize your security with industry-leading
                  encryption, multi-factor authentication, and robust protocols
                  to protect your data and assets.
                </p>
              </div>
            </div>

            <div class="faq-item">
              <button class="faq-question" aria-expanded="false">
                What kind of support can I expect?
                <span class="material-icons">expand_more</span>
              </button>
              <div class="faq-answer">
                <p>
                  We offer 24/7 support from our expert team, ready to assist
                  you with any questions or issues to ensure a smooth trading
                  experience.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="cta-section fade-in-section">
        <div class="container cta-content">
          <h2 class="cta-title">Ready to Elevate Your Trading?</h2>
          <p class="cta-desc">
            Join thousands of successful traders who trust TradeBuddy for their
            market insights and secure transactions. Start your free trial
            today!
          </p>
          <button class="cta-button" id="ctaFreeTrialBtn">
            Start Your Free Trial Now
          </button>
        </div>
      </section>
    </main>
    <footer class="fade-in-section">
      &copy; 2024 TradeBuddy. All rights reserved. | Built with precision and
      care.
    </footer>



    <!-- Defer non-critical JavaScript -->
    <script defer>
      // Utility function to select elements
      const select = (selector) => document.querySelector(selector);
      const selectAll = (selector) => document.querySelectorAll(selector);

      // --- Global Initializations ---
      window.addEventListener("load", () => {
         window.scrollTo(0, 0); // Scroll to top on page load
         initializeHeaderBlur();
         initializeMobileNav();
         initializeFadeInSections();
         initializeFaqAccordion();
         initializeScrollSpy();
         initializeBackToTop();
         initializeSearchModal(); // initialize search modal (async + debounced)
       });

      // --- Header Blur Effect ---
      function initializeHeaderBlur() {
        const headerInner = select("#mainHeader");
        if (!headerInner) return;

        const headerEl = headerInner.closest('header');

        window.addEventListener("scroll", () => {
          if (window.scrollY > 1) {
            headerInner.classList.add("blur");
            if (headerEl) headerEl.classList.add('is-sticky');
          } else {
            headerInner.classList.remove("blur");
            if (headerEl) headerEl.classList.remove('is-sticky');
          }
        });
      }

      // --- Mobile Navigation Logic (cleaned) ---
      function initializeMobileNav() {
        const toggleBtn = select(".mobile-toggle");
        const mobileNav = select("#mobileNavPanel");
        const overlay = select("#mobileNavOverlay");
        const closeBtn = select(".close-btn");
        const mobileDropdownToggle = select(".dropdown-toggle-mobile");
        const mobileDropdownContent = select(".dropdown-content-mobile");

        if (!toggleBtn || !mobileNav || !overlay || !closeBtn) return;

        const openMobileMenu = () => {
          mobileNav.classList.add("active");
          overlay.classList.add("active");
          toggleBtn.setAttribute("aria-expanded", "true");
          toggleBtn.classList.add('open');
          document.body.style.overflow = "hidden"; // Prevent scrolling behind panel
        };

        const closeMobileMenu = () => {
          mobileNav.classList.remove("active");
          overlay.classList.remove("active");
          toggleBtn.setAttribute("aria-expanded", "false");
          toggleBtn.classList.remove('open');
          document.body.style.overflow = ""; // Restore scrolling
          // Ensure mobile dropdown is closed when nav closes
          if (mobileDropdownContent && mobileDropdownContent.classList.contains('active')) {
            mobileDropdownContent.classList.remove('active');
            mobileDropdownToggle.classList.remove('active');
          }
        };

        // Expose closeMobileMenu to global scope for other handlers
        window.closeMobileMenu = closeMobileMenu;

        toggleBtn.addEventListener("click", () => {
          if (mobileNav.classList.contains('active')) closeMobileMenu(); else openMobileMenu();
        });
        closeBtn.addEventListener("click", closeMobileMenu);
        overlay.addEventListener("click", closeMobileMenu);

        // Close on ESC key
        window.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && mobileNav.classList.contains("active")) {
            closeMobileMenu();
          }
        });

        // Mobile Dropdown Toggle
        if (mobileDropdownToggle && mobileDropdownContent) {
          mobileDropdownToggle.addEventListener("click", (e) => {
            e.preventDefault(); // Prevent default link behavior
            mobileDropdownContent.classList.toggle("active");
            mobileDropdownToggle.classList.toggle("active"); // For arrow rotation
          });
        }

        // Close mobile nav when a link inside it is clicked (except dropdown toggle)
        selectAll('.mobile-nav-panel a').forEach(link => {
          if (link !== mobileDropdownToggle) {
            link.addEventListener('click', closeMobileMenu);
          }
        });
      }

      // --- Scroll-in Animation (enhanced: directional slide + stagger) ---
      function initializeFadeInSections() {
        const fadeInSections = selectAll(".fade-in-section");
        if (fadeInSections.length === 0) return;

        const observerOptions = {
          root: null,
          rootMargin: "0px 0px -10% 0px",
          threshold: 0.12,
        };

        // map elements to computed direction (left/right)
        const elDirections = new Map();

        const staggerSelector = '.card, .step-card, .testimonial-card, .why-choose-us-point, .faq-item, .result-item';

        const observer = new IntersectionObserver((entries, obs) => {
          entries.forEach((entry) => {
            const el = entry.target;
            if (!entry.isIntersecting) return;

            const dir = elDirections.get(el) || 'left';
            // mark parent visible and add directional class
            el.classList.add('is-visible', `slide-in-${dir}`);

            // stagger children for nicer grouped reveals
            const children = el.querySelectorAll('.stagger-child');
            children.forEach((c, i) => {
              c.style.transitionDelay = `${i * 75}ms`;
              c.classList.add('in-view-child');
            });

            // stop observing once revealed
            obs.unobserve(el);
          });
        }, observerOptions);

        // Assign directions and prepare staggerable children
        fadeInSections.forEach((section, idx) => {
          // allow explicit override via data-animate="left|right"
          const explicit = (section.dataset && section.dataset.animate) ? section.dataset.animate : null;
          const dir = explicit === 'left' || explicit === 'right' ? explicit : (idx % 2 === 0 ? 'left' : 'right');
          elDirections.set(section, dir);

          // mark potential stagger children with helper class
          const staggerables = section.querySelectorAll(staggerSelector);
          staggerables.forEach((s) => s.classList.add('stagger-child'));

          // initial small transform for parent to match directional slide
          if (dir === 'left') section.classList.add('slide-in-left'); else section.classList.add('slide-in-right');

          observer.observe(section);
        });
      }

      // --- Smooth scroll and ScrollSpy ---
      function initializeScrollSpy() {
        const navLinks = selectAll('nav.desktop-nav a');
        const sections = [];
        navLinks.forEach(link => {
          const href = link.getAttribute('href');
          if (href && href.startsWith('#')) {
            const section = document.querySelector(href);
            if (section) sections.push({link, section});
            // Smooth scroll on click
            link.addEventListener('click', (e) => {
              e.preventDefault();
              document.querySelector(href).scrollIntoView({behavior: 'smooth', block: 'start'});
            });
          }
        });

        // Update active link on scroll
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            const item = sections.find(s => s.section === entry.target);
            if (!item) return;
            if (entry.isIntersecting) {
              navLinks.forEach(l => l.classList.remove('active'));
              item.link.classList.add('active');
            }
          });
        }, {root: null, threshold: 0.45});

        sections.forEach(s => observer.observe(s.section));
      }

      // --- Back to Top ---
      function initializeBackToTop() {
        const btn = document.createElement('button');
        btn.className = 'back-to-top';
        btn.setAttribute('aria-label', 'Back to top');
        btn.innerHTML = '';
        document.body.appendChild(btn);

        const toggleVisibility = () => {
          if (window.scrollY > 400) btn.classList.add('show'); else btn.classList.remove('show');
        };

        btn.addEventListener('click', () => window.scrollTo({top:0, behavior:'smooth'}));
        window.addEventListener('scroll', toggleVisibility);
        toggleVisibility();
      }

      // --- FAQ Accordion Logic ---
      function initializeFaqAccordion() {
        const faqItems = selectAll(".faq-item");
 
        faqItems.forEach((item) => {
          const questionButton = item.querySelector(".faq-question");
          const answerDiv = item.querySelector(".faq-answer");

          if (questionButton && answerDiv) {
            questionButton.addEventListener("click", () => {
              const isActive = questionButton.classList.contains("active");

              // Close all other open FAQ items
              faqItems.forEach((otherItem) => {
                const otherQuestion = otherItem.querySelector(".faq-question");
                const otherAnswer = otherItem.querySelector(".faq-answer");
                if (otherQuestion !== questionButton && otherQuestion.classList.contains("active")) {
                  otherQuestion.classList.remove("active");
                  otherQuestion.setAttribute("aria-expanded", "false");
                  otherAnswer.classList.remove("active");
                }
              });

              // Toggle the clicked FAQ item
              questionButton.classList.toggle("active", !isActive);
              questionButton.setAttribute("aria-expanded", String(!isActive));
              answerDiv.classList.toggle("active", !isActive);
            });
          }
        });
      }

      // --- Search Modal: async loading + debounced queries + abort previous ---
      function initializeSearchModal() {
        const modal = select('#searchModal');
        const input = select('#searchInput');
        const clearBtn = select('#clearSearch');
        const closeBtn = select('#closeSearchModal');
        const chipsContainer = select('#searchChips');
        const resultsContainer = select('#searchResults');
        const status = select('#searchStatus');

        if (!modal || !input || !chipsContainer || !resultsContainer || !status) return;

        // Demo dataset with broad coverage (NSE, BSE, MCX). Replace /extend with your backend symbol list.
        // For real-time prices you must provide a BACKEND_WS or a realtime provider (see BACKEND_WS later).
        const demoSymbols = [
          // NSE Equities
          { symbol: 'RELIANCE', name: 'Reliance Industries Ltd', type: 'Stocks', exchange: 'NSE', country: 'IN', price: 2500 },
          { symbol: 'TCS', name: 'Tata Consultancy Services Ltd', type: 'Stocks', exchange: 'NSE', country: 'IN', price: 3200 },
          { symbol: 'INFY', name: 'Infosys Ltd', type: 'Stocks', exchange: 'NSE', country: 'IN', price: 1500 },
          { symbol: 'HDFCBANK', name: 'HDFC Bank Ltd', type: 'Stocks', exchange: 'NSE', country: 'IN', price: 1500 },
          { symbol: 'ICICIBANK', name: 'ICICI Bank Ltd', type: 'Stocks', exchange: 'NSE', country: 'IN', price: 950 },
          { symbol: 'BHARTIARTL', name: 'Bharti Airtel Ltd', type: 'Stocks', exchange: 'NSE', country: 'IN', price: 650 },
          // BSE Equities (sample symbols; BSE symbols sometimes include .BO suffix on some feeds)
          { symbol: '500325', name: 'Reliance Industries Ltd (BSE)', type: 'Stocks', exchange: 'BSE', country: 'IN', price: 2500 },
          { symbol: '532540', name: 'TCS (BSE)', type: 'Stocks', exchange: 'BSE', country: 'IN', price: 3200 },
          { symbol: '500209', name: 'HDFC Bank (BSE)', type: 'Stocks', exchange: 'BSE', country: 'IN', price: 1500 },
          // Indices
          { symbol: 'NIFTY', name: 'Nifty 50 Index', type: 'Indices', exchange: 'NSE', country: 'IN', price: 22000 },
          { symbol: 'SENSEX', name: 'BSE Sensex', type: 'Indices', exchange: 'BSE', country: 'IN', price: 74000 },
          // ETFs / Funds
          { symbol: 'SBIETF', name: 'SBI ETF Nifty 50', type: 'ETF', exchange: 'NSE', country: 'IN', price: 2000 },
          { symbol: 'MUTFUND1', name: 'Sample Mutual Fund', type: 'Funds', exchange: 'NSE', country: 'IN', price: 120 },
          // Futures / Options (sample contract names; in production use exchange-specific symbols)
          { symbol: 'NSE_FUT_NIFTY_D', name: 'Nifty Futures (sample)', type: 'Futures', exchange: 'NSE', country: 'IN', price: 22050 },
          { symbol: 'OPTIONS_NIFTY_XXXX', name: 'Nifty Option (sample)', type: 'Options', exchange: 'NSE', country: 'IN', price: 50 },
          // MCX Commodities (sample MCX contract symbols)
          { symbol: 'GOLD', name: 'Gold (MCX)', type: 'Commodity', exchange: 'MCX', country: 'IN', price: 62000 },
          { symbol: 'SILVER', name: 'Silver (MCX)', type: 'Commodity', exchange: 'MCX', country: 'IN', price: 73000 },
          { symbol: 'CRUDEOIL', name: 'Crude Oil (MCX)', type: 'Commodity', exchange: 'MCX', country: 'IN', price: 5200 },
          { symbol: 'NATGAS', name: 'Natural Gas (MCX)', type: 'Commodity', exchange: 'MCX', country: 'IN', price: 190 },
          // Crypto / International (optional)
          { symbol: 'BTCUSD', name: 'Bitcoin / U.S. Dollar', type: 'Crypto', exchange: 'COINBASE', country: '', price: 60000 },
          // Additional commonly-traded NSE/BSE names (add more as needed)
          { symbol: 'HINDUNILVR', name: 'Hindustan Unilever Ltd', type: 'Stocks', exchange: 'NSE', country: 'IN', price: 2600 },
          { symbol: 'AXISBANK', name: 'Axis Bank Ltd', type: 'Stocks', exchange: 'NSE', country: 'IN', price: 800 },
          { symbol: 'LT', name: 'Larsen & Toubro Ltd', type: 'Stocks', exchange: 'NSE', country: 'IN', price: 3400 },
          { symbol: 'SUNPHARMA', name: 'Sun Pharmaceuticals', type: 'Stocks', exchange: 'NSE', country: 'IN', price: 1100 }
        ];

        // Try to fetch an authoritative India symbol list from your backend (if available).
        // Replace the URL with your real endpoint that returns JSON array of symbols in the same shape.
        (function tryLoadSymbolMaster() {
          const SRC = '/api/india-symbols'; // <--- change to your backend endpoint or CDN JSON file
          const timeout = 2500;
          const controller = new AbortController();
          const id = setTimeout(() => controller.abort(), timeout);

          fetch(SRC, { signal: controller.signal })
            .then((r) => {
              clearTimeout(id);
              if (!r.ok) throw new Error('no-symbols');
              return r.json();
            })
            .then((data) => {
              if (!Array.isArray(data) || data.length === 0) return;
              // normalize and replace demoSymbols contents
              demoSymbols.length = 0;
              data.forEach((it) => {
          // ensure essential fields exist
          demoSymbols.push({
            symbol: (it.symbol || it.ticker || it.code || '').toString().toUpperCase(),
            name: it.name || it.description || '',
            type: it.type || it.assetClass || 'Stocks',
            exchange: (it.exchange || '').toUpperCase() || 'NSE',
            country: it.country || 'IN',
            price: (typeof it.price === 'number') ? it.price : (it.lastPrice || 0)
          });
              });
              // If modal is open, refresh visible results and realtime seeds after symbol master loads
              try {
          if (typeof renderChips === 'function') renderChips();
          if (typeof performSearch === 'function') performSearch();
          // If realtime already exists, seed its internal prices object
          if (window.realtime && window.realtime.simulate) {
            demoSymbols.forEach(s => {
              if (s && s.symbol) window.realtime.prices[s.symbol] = (s.price || window.realtime.prices[s.symbol] || (Math.random()*1000+50)).toFixed(2);
            });
          }
              } catch (e) {
          // ignore - these functions may not be defined yet during initialization
              }
            })
            .catch(() => {
              // no-op: keep demoSymbols fallback. In production, provide a reliable symbol master.
            });
        })();

        // NOTE: Real-time pricing
        // - This UI is designed to work with a WebSocket realtime provider.
        // - Set BACKEND_WS (above in initializeSearchModal) to your provider's ws:// or wss:// URL.
        // - The RealtimeClient will subscribe/unsubscribe by symbol name.
        // - Many exchanges/pro-data vendors require licensing; you must integrate a commercial feed or your own gateway.
        //
        // Example: if you have a WebSocket gateway at wss://feed.example.com, set:
        //   const BACKEND_WS = 'wss://feed.example.com';
        //
        // If no BACKEND_WS is provided the page uses a local simulation seeded from demoSymbols.

        // categories
        const CATEGORIES = ['All','Stocks','Funds','Futures','ETF','Indices','Options'];
        let activeCategory = 'All';

        // Abort controller placeholder for future remote fetches
        let currentController = null;

        // STATUS helper
        function setStatus(text, loading=false){
          status.textContent = '';
          if (!text) return;
          if (loading) status.innerHTML = `<span style="opacity:.9">${text}</span>`;
          else status.textContent = text;
        }

        // basic debounce
        let debounceTimer = null;
        function debounce(fn, wait=250){
          return (...args)=>{
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(()=>fn(...args), wait);
          };
        }

        // render category chips
        function renderChips(){
          chipsContainer.innerHTML = '';
          CATEGORIES.forEach(cat=>{
            const b = document.createElement('button');
            b.type = 'button';
            b.className = 'chip' + (cat===activeCategory ? ' active' : '');
            b.textContent = cat;
            b.addEventListener('click', ()=>{
              activeCategory = cat;
              renderChips();
              triggerSearch();
              input.focus();
            });
            chipsContainer.appendChild(b);
          });
        }

        // helper to escape selector characters for data-symbol selectors
        function escapeSelector(s){ return String(s).replace(/(["\\.\\[\\]:,#>+~*^$|=!@])/g,'\\\\$1'); }

        // render results into DOM (core renderer)
        function renderResultsInner(items, q){
          resultsContainer.innerHTML = '';
          if (!items || items.length === 0) {
            resultsContainer.innerHTML = '<div class="no-results"> </div>';
            return;
          }
          items.forEach(it=>{
            const row = document.createElement('div');
            row.className = 'result-item';
            row.setAttribute('data-symbol', (it.symbol||'').toUpperCase());
            row.setAttribute('role','listitem');

            row.innerHTML = `<div style="text-align:left">
              <strong style="display:block">${it.symbol}</strong>
              <div style="font-size:0.95rem;color:#cfc7e8">${it.name}</div>
            </div>
            <div class="result-meta" style="min-width:130px;text-align:right">${it.type || ''}  ${it.exchange || ''}</div>`;

            // price placeholder (updated by realtime)
            const priceWrap = document.createElement('div');
            priceWrap.className = 'price';
            priceWrap.innerHTML = `<span class="value">${(it.price?Number(it.price).toFixed(2):'--')}</span><span class="delta">${it.price?'+0.00':''}</span>`;
            row.appendChild(priceWrap);

            row.addEventListener('click', ()=>{
              // selection behavior: fill input and close modal
              input.value = it.symbol;
              setStatus(`Selected: ${it.symbol}`);
              closeSearch();
            });

            resultsContainer.appendChild(row);
          });
        }

        // wrap renderer to unsubscribe visible symbols before rendering new list
        function unsubscribeAllVisible(){
          const rows = resultsContainer.querySelectorAll('.result-item[data-symbol]');
          rows.forEach(r=>{
            const s = r.getAttribute('data-symbol');
            if (s && realtime) realtime.unsubscribe(s);
          });
        }
        // replace renderResults reference used elsewhere
        let renderResults = (items, q) => {
          renderResultsInner(items, q);
        };

        // local filtering (demo-only). Replace with remote fetch when backend exists.
        function filterLocal(q){
          const qq = (q||'').trim().toLowerCase();
          return demoSymbols.filter(it=>{
            // category filter
            if (activeCategory !== 'All' && it.type && it.type.toLowerCase() !== activeCategory.toLowerCase()) return false;
            if (!qq) return true;
            return (it.symbol||'').toLowerCase().includes(qq) || (it.name||'').toLowerCase().includes(qq);
          }).slice(0,100);
        }

        // main search: for now local only; can later call backend and set currentController
        async function performSearch(){
          const q = input.value || '';
          setStatus('', false);
          // use local filter
          const items = filterLocal(q);
          if (!items.length) setStatus('', false);
          else setStatus(`${items.length} results`, false);
          // unsubscribe prior visible
          unsubscribeAllVisible();
          renderResults(items, q);
          // subscribe visible to realtime
          const rows = resultsContainer.querySelectorAll('.result-item[data-symbol]');
          rows.forEach(r=>{
            const s = r.getAttribute('data-symbol');
            if (s && realtime) realtime.subscribe(s);
          });
        }

        const triggerSearch = debounce(performSearch, 220);

        // --- Realtime client (simulation when no BACKEND_WS) ---
        const BACKEND_WS = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') ? 'ws://localhost:8080' : '';
        class RealtimeClient {
          constructor(url, opts = {}){
            this.url = url;
            this.simulate = !url;
            this.onMessage = opts.onMessage || function(){};
            this.interval = null;
            this.ws = null;
            this.subscribers = new Set();
            this.prices = {};
            if (this.simulate) this._startSimulation(opts.seed || []);
            else this._connect();
          }
          _connect(){
            try{
              this.ws = new WebSocket(this.url);
              this.ws.addEventListener('open', ()=>console.info('WS open'));
              this.ws.addEventListener('message', (ev)=> {
                try{ this.onMessage(JSON.parse(ev.data)); } catch(e){ console.warn(e); }
              });
              this.ws.addEventListener('close', ()=> setTimeout(()=>this._connect(), 2000));
            } catch(e){ console.warn('WS failed', e); }
          }
          _startSimulation(seed){
            seed.forEach(s => this.prices[s.symbol] = (s.price || (Math.random()*1000+100)).toFixed(2));
            this.interval = setInterval(()=>{
              if (this.subscribers.size === 0) return;
              const subs = Array.from(this.subscribers);
              const count = Math.max(1, Math.min(subs.length, Math.ceil(subs.length * 0.35)));
              for (let i=0;i<count;i++){
                const sym = subs[Math.floor(Math.random()*subs.length)];
                const prev = parseFloat(this.prices[sym] || (Math.random()*1000+100).toFixed(2));
                const delta = (prev * (Math.random()*0.008 - 0.004));
                const next = Math.max(0.01, prev + delta);
                this.prices[sym] = next.toFixed(2);
                const msg = { symbol: sym, price: next, change: +(next - prev).toFixed(2), pct: +(((next - prev)/prev)*100).toFixed(2), time: Date.now() };
                this.onMessage(msg);
              }
            }, 900);
          }
          subscribe(symbol){
            if(!symbol) return;
            this.subscribers.add(symbol);
            if (this.simulate && !this.prices[symbol]) this.prices[symbol] = (Math.random()*2000+50).toFixed(2);
            if (!this.simulate && this.ws && this.ws.readyState === WebSocket.OPEN){
              try{ this.ws.send(JSON.stringify({ action:'subscribe', symbol })); }catch(e){}
            }
          }
          unsubscribe(symbol){
            if(!symbol) return;
            this.subscribers.delete(symbol);
            if (!this.simulate && this.ws && this.ws.readyState === WebSocket.OPEN){
              try{ this.ws.send(JSON.stringify({ action:'unsubscribe', symbol })); }catch(e){}
            }
          }
          close(){
            if (this.interval) clearInterval(this.interval);
            if (this.ws) this.ws.close();
          }
        }

        // realtime instance
        const realtime = new RealtimeClient(BACKEND_WS || '', { onMessage: handleRealtimeMessage, seed: demoSymbols });

        // handle incoming realtime messages: update DOM row price
        function handleRealtimeMessage(msg){
          if (!msg || !msg.symbol) return;
          const sym = String(msg.symbol).toUpperCase();
          const row = resultsContainer.querySelector(`.result-item[data-symbol="${escapeSelector(sym)}"]`);
          if (!row) return;
          let priceEl = row.querySelector('.price .value');
          let deltaEl = row.querySelector('.price .delta');
          if (!priceEl){
            const priceWrap = document.createElement('div');
            priceWrap.className = 'price';
            priceWrap.innerHTML = `<span class="value"></span><span class="delta"></span>`;
            row.appendChild(priceWrap);
            priceEl = priceWrap.querySelector('.value');
            deltaEl = priceWrap.querySelector('.delta');
          }
          const price = (typeof msg.price === 'number') ? msg.price.toFixed(2) : msg.price;
          const change = (typeof msg.change === 'number') ? (msg.change > 0 ? '+' + msg.change.toFixed(2) : msg.change.toFixed(2)) : (msg.change||'');
          const pct = (typeof msg.pct === 'number') ? ` (${msg.pct>0?'+':''}${msg.pct.toFixed(2)}%)` : '';
          priceEl.textContent = price;
          deltaEl.textContent = change + pct;
          const priceWrap = row.querySelector('.price');
          if (msg.change > 0) { priceWrap.classList.add('up'); priceWrap.classList.remove('down'); }
          else if (msg.change < 0) { priceWrap.classList.add('down'); priceWrap.classList.remove('up'); }
          else { priceWrap.classList.remove('down','up'); }
        }

        // wire UI actions
        function openSearch(){
          modal.classList.add('active');
          modal.setAttribute('aria-hidden','false');
          document.body.style.overflow = 'hidden';
          // show full list when opening search (default = All)
          input.value = '';
          activeCategory = 'All';
          renderChips();
          // perform search immediately (shows all items in "All" category)
          // unsubscribe any previous subscriptions then render & subscribe new rows
          unsubscribeAllVisible();
          performSearch(); // immediate, not debounced  shows all results for "All"
          setTimeout(()=>input.focus(), 120);
        }
        function closeSearch(){
          modal.classList.remove('active');
          modal.setAttribute('aria-hidden','true');
          document.body.style.overflow = '';
          if (currentController) {
            try { currentController.abort(); } catch(e) {}
            currentController = null;
          }
          unsubscribeAllVisible();
          // keep realtime running for faster re-open; call realtime.close() if you want to stop it
        }

        // event bindings
        // open modal when any link to #search clicked
        selectAll('a[href="#search"]').forEach(link=>{
          link.addEventListener('click', (e)=>{ e.preventDefault(); openSearch(); });
        });
        closeBtn && closeBtn.addEventListener('click', closeSearch);
        modal.addEventListener('click', (e)=>{ if (e.target === modal) closeSearch(); });
        window.addEventListener('keydown', (e)=>{ if (e.key === 'Escape' && modal.classList.contains('active')) closeSearch(); });

        input.addEventListener('input', ()=>{
          setStatus('Typing...', true);
          triggerSearch();
        });
        clearBtn.addEventListener('click', ()=>{
          input.value = '';
          triggerSearch();
          input.focus();
        });

        // expose initial chips & results
        renderChips();
      }
    </script>
    <script>
      // Client-side auth check: hide Login/SignUp buttons when authenticated
      (function(){
        try{
          const authRaw = localStorage.getItem('tradebuddy_auth');
          if (!authRaw) return;
          const auth = JSON.parse(authRaw);
          if (!auth || !auth.email) return;

          // Hide all login/signup buttons
          document.querySelectorAll('.btn-contact').forEach(el => el.style.display = 'none');

          // Insert user menu into header-inner
          const headerInner = document.querySelector('.header-inner');
          if (!headerInner) return;

          const existing = document.getElementById('userMenuBtn');
          if (existing) return;

          // Create a polished user badge with avatar, name and an accessible dropdown menu
          // Inject styles once
          if (!document.getElementById('tb-user-styles')){
            const s = document.createElement('style');
            s.id = 'tb-user-styles';
            s.textContent = `
              .tb-user { display:flex; align-items:center; gap:0.5rem; position:relative; }
              .tb-user-btn { display:flex; align-items:center; gap:0.5rem; background:transparent; border:0; padding:0.15rem 0.25rem; cursor:pointer; }
              .tb-user-avatar { width:36px; height:36px; border-radius:50%; display:inline-grid; place-items:center; font-weight:700; color:var(--bg); background:linear-gradient(135deg,var(--accent),#8a5cff); box-shadow:0 2px 8px rgba(0,0,0,0.25); flex:0 0 36px; }
              .tb-user-name { color:var(--accent); font-weight:700; font-size:0.95rem; white-space:nowrap; }
              .tb-user-chevron { color:var(--muted); font-size:0.95rem; transition:transform .18s ease; }
              .tb-user[aria-expanded="true"] .tb-user-chevron { transform:rotate(180deg); }
              .tb-user-menu { position:absolute; right:0; top:calc(100% + 8px); min-width:160px; background:rgba(18,18,20,0.9); backdrop-filter:blur(6px); border-radius:8px; box-shadow:0 8px 24px rgba(0,0,0,0.4); padding:8px 6px; z-index:9999; display:none; }
              .tb-user[aria-expanded="true"] .tb-user-menu { display:block; }
              .tb-user-menu a, .tb-user-menu button { display:block; width:100%; text-align:left; padding:8px 10px; color:var(--muted); background:transparent; border:0; border-radius:6px; font-size:0.92rem; }
              .tb-user-menu a:hover, .tb-user-menu button:hover { background:rgba(255,255,255,0.02); color:var(--accent); }
              .tb-user-sep { height:1px; background:rgba(255,255,255,0.03); margin:6px 4px; border-radius:2px; }
            `;
            document.head.appendChild(s);
          }

          const userWrapper = document.createElement('div');
          userWrapper.id = 'userMenuBtn';
          userWrapper.className = 'tb-user';
          userWrapper.setAttribute('role','region');
          userWrapper.setAttribute('aria-expanded','false');

          const btn = document.createElement('button');
          btn.className = 'tb-user-btn';
          btn.setAttribute('aria-haspopup','true');
          btn.setAttribute('aria-expanded','false');

          const initials = (auth.name && auth.name.split(' ').map(n=>n[0]).slice(0,2).join('')) || auth.email.split('@')[0].slice(0,2).toUpperCase();
          const avatar = document.createElement('span');
          avatar.className = 'tb-user-avatar';
          avatar.textContent = initials;

          const nameSpan = document.createElement('span');
          nameSpan.className = 'tb-user-name';
          nameSpan.textContent = auth.name ? auth.name : auth.email.split('@')[0];

          const chevron = document.createElement('span');
          chevron.className = 'tb-user-chevron';
          chevron.innerHTML = '\u25BE';

          btn.appendChild(avatar);
          btn.appendChild(nameSpan);
          btn.appendChild(chevron);

          const menu = document.createElement('div');
          menu.className = 'tb-user-menu';
          menu.setAttribute('role','menu');

          const account = document.createElement('a');
          account.href = '#account';
          account.textContent = 'Profile';
          account.setAttribute('role','menuitem');
          account.addEventListener('click', (e)=>{ e.preventDefault(); window.location.href = 'login.html'; });

          const settings = document.createElement('a');
          settings.href = '#settings';
          settings.textContent = 'Settings';
          settings.setAttribute('role','menuitem');
          settings.addEventListener('click', (e)=>{ e.preventDefault(); alert('Settings are not implemented in this demo.'); });

          const sep = document.createElement('div');
          sep.className = 'tb-user-sep';

          const logoutBtn = document.createElement('button');
          logoutBtn.type = 'button';
          logoutBtn.textContent = 'Logout';
          logoutBtn.setAttribute('role','menuitem');
          logoutBtn.addEventListener('click', ()=>{
            localStorage.removeItem('tradebuddy_auth');
            document.querySelectorAll('.btn-contact').forEach(el => el.style.display = '');
            // close menu then reload
            userWrapper.setAttribute('aria-expanded','false');
            btn.setAttribute('aria-expanded','false');
            window.location.reload();
          });

          menu.appendChild(account);
          menu.appendChild(settings);
          menu.appendChild(sep);
          menu.appendChild(logoutBtn);

          // Toggle handlers
          btn.addEventListener('click', (e)=>{
            const expanded = userWrapper.getAttribute('aria-expanded') === 'true';
            userWrapper.setAttribute('aria-expanded', expanded ? 'false' : 'true');
            btn.setAttribute('aria-expanded', expanded ? 'false' : 'true');
          });

          // close when clicking outside
          document.addEventListener('click', (e)=>{
            if (!userWrapper.contains(e.target)){
              userWrapper.setAttribute('aria-expanded','false');
              btn.setAttribute('aria-expanded','false');
            }
          });

          userWrapper.appendChild(btn);
          userWrapper.appendChild(menu);

          // place before the mobile toggle if present
          const mobileToggle = headerInner.querySelector('.mobile-toggle');
          if (mobileToggle) headerInner.insertBefore(userWrapper, mobileToggle);
          else headerInner.appendChild(userWrapper);
        } catch (e) { console.warn('auth-check failed', e); }
      })();
    </script>
  </body>
</html>
